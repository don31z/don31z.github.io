<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surprise</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: black;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .center-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 13px #FFD600, 0 0 24px #FFA600;
            animation: glow 1.5s infinite alternate;
            z-index: 10;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 10px #FFD600, 0 0 20px #FFA600;
            }

            to {
                text-shadow: 0 0 25px #FFA600, 0 0 50px #FFAA00;
            }
        }
    </style>
</head>

<body>
    <canvas id="heartCanvas"></canvas>
    <div id="centerText" class="center-text">七夕快樂❤</div>

    <script>
        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');
        const centerText = document.getElementById('centerText');

        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        let centerX = width / 2;
        let centerY = height / 2;
        let enlarge = Math.min(width, height) / 40;
        let baseFontSize = Math.min(width, height) / 10; // 文字基準大小
        centerText.style.fontSize = `${baseFontSize}px`;

        function updateCenter() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            centerX = width / 2;
            centerY = height / 2;
            enlarge = Math.min(width, height) / 40;
            baseFontSize = Math.min(width, height) / 10;
        }

        function heartFunction(t, scale = enlarge) {
            let x = 16 * Math.pow(Math.sin(t), 3);
            let y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
            x *= scale;
            y *= scale;
            x += centerX;
            y += centerY;
            return { x, y };
        }

        function scatterInside(x, y, beta = 0.15) {
            const ratioX = -beta * Math.log(Math.random());
            const ratioY = -beta * Math.log(Math.random());
            const dx = ratioX * (x - centerX);
            const dy = ratioY * (y - centerY);
            return { x: x - dx, y: y - dy };
        }

        let basePoints = [];
        let edgePoints = [];
        let centerPoints = [];

        function buildHeart() {
            basePoints = [];
            edgePoints = [];
            centerPoints = [];

            for (let i = 0; i < 2000; i++) {
                let t = Math.random() * 2 * Math.PI;
                basePoints.push(heartFunction(t));
            }

            basePoints.forEach(p => {
                for (let i = 0; i < 3; i++) {
                    edgePoints.push(scatterInside(p.x, p.y, 0.05));
                }
            });

            for (let i = 0; i < 4000; i++) {
                let p = basePoints[Math.floor(Math.random() * basePoints.length)];
                centerPoints.push(scatterInside(p.x, p.y, 0.17));
            }
        }

        buildHeart();

        let frame = 27;
        function curve(p) {
            return 2 * (2 * Math.sin(4 * p)) / (2 * Math.PI);
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            frame++;

            // 光暈效果
            let haloRadius = 6 + 6 * (1 + curve(frame / 52.0 * Math.PI));
            let haloCount = 3240 + 1314 * Math.pow(Math.abs(curve(frame / 20 * Math.PI)), 2);

            for (let i = 0; i < haloCount; i++) {
                let t = Math.random() * 2 * Math.PI;
                let p = heartFunction(t, enlarge * 1.05);
                let dx = (p.x - centerX) * (1 + haloRadius / 10);
                let dy = (p.y - centerY) * (1 + haloRadius / 10);
                ctx.fillStyle = `rgba(255, 200, 200, ${Math.random() * 0.3})`;
                ctx.fillRect(centerX + dx + Math.random() * 14 - 7, centerY + dy + Math.random() * 14 - 7, 2, 2);
            }

            // 愛心點
            function drawPoints(points, color, sizeRange = [1, 3]) {
                points.forEach(p => {
                    let ratio = 10 * curve(frame / 32.4 * Math.PI);
                    let force = 1 / Math.pow(Math.pow(p.x - centerX, 2) + Math.pow(p.y - centerY, 2), 0.52);
                    let dx = ratio * force * (p.x - centerX) + (Math.random() * 2 - 1);
                    let dy = ratio * force * (p.y - centerY) + (Math.random() * 2 - 1);
                    let size = Math.floor(Math.random() * (sizeRange[1] - sizeRange[0] + 1)) + sizeRange[0];
                    ctx.fillStyle = color;
                    ctx.fillRect(p.x - dx, p.y - dy, size, size);
                });
            }

            drawPoints(basePoints, "#FF99CC", [1, 3]);
            drawPoints(edgePoints, "#FF66CC", [1, 2]);
            drawPoints(centerPoints, "#FF3399", [1, 2]);

            // **讓文字跟著跳動**
            let scale = 1 + 0.2 * curve(frame / 32.4 * Math.PI);
            centerText.style.transform = `translate(-50%, -50%) scale(${scale})`;

            requestAnimationFrame(draw);
        }

        draw();

        window.addEventListener('resize', () => {
            updateCenter();
            buildHeart();
        });
    </script>
</body>

</html>
